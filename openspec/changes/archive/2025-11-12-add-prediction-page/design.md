## Context
訓練頁面已經實現了模型訓練和保存功能，模型可以：
1. 保存在 session state 中（`st.session_state['trained_model']`）
2. 保存到檔案系統（`models/` 目錄，使用 joblib 格式）

預測頁面需要能夠使用這些模型進行預測，並支援兩種輸入方式：單筆資料和 CSV 批次預測。

## Goals / Non-Goals
- **Goals**:
  - 提供簡單易用的預測介面，適合非程式人員使用
  - 支援從 session state 或檔案系統載入模型
  - 支援單筆資料和 CSV 批次預測
  - 驗證輸入資料格式與模型特徵的一致性
  - 提供清晰的預測結果展示和匯出功能

- **Non-Goals**:
  - 不支援模型訓練（訓練功能在訓練頁面）
  - 不支援模型編輯或修改（僅使用現有模型）
  - 不支援即時預測 API（僅支援頁面內預測）
  - 不支援預測結果的進一步分析（僅顯示和匯出）

## Decisions
- **Decision**: 優先使用 session state 中的模型，其次使用檔案系統中的模型
  - **Rationale**: 如果使用者剛訓練完模型，應該可以直接使用，無需重新載入檔案
  - **Alternatives considered**: 
    - 僅支援檔案載入：需要使用者先保存模型，增加操作步驟
    - 僅支援 session state：無法使用之前保存的模型，限制使用場景

- **Decision**: 單筆預測使用表單輸入，批次預測使用 CSV 上傳
  - **Rationale**: 表單輸入適合單筆資料，CSV 上傳適合批次處理，符合使用者習慣
  - **Alternatives considered**: 
    - 僅支援 CSV：無法快速測試單筆預測
    - 僅支援表單：無法處理大量資料

- **Decision**: 預測結果匯出為 CSV 格式
  - **Rationale**: CSV 格式通用且易於處理，符合資料分析工作流程
  - **Alternatives considered**: 
    - JSON 格式：不夠通用，非程式人員不熟悉
    - Excel 格式：需要額外依賴，增加複雜度

- **Decision**: 嚴格驗證輸入資料格式與模型特徵的一致性
  - **Rationale**: 確保預測結果的準確性，避免因資料格式不符導致的錯誤
  - **Alternatives considered**: 
    - 寬鬆驗證：可能導致預測結果不準確
    - 自動修正：可能改變使用者意圖，不符合簡單優先原則

- **Decision**: 預測結果顯示包含原始輸入資料和預測值
  - **Rationale**: 讓使用者可以對照輸入和輸出，便於驗證和理解
  - **Alternatives considered**: 
    - 僅顯示預測值：使用者無法對照驗證

## Implementation Details
- **模型載入流程**:
  1. 檢查 session state 中是否有 `trained_model`
  2. 如果有，使用 session state 中的模型
  3. 如果沒有，顯示模型選擇器，讓使用者選擇已保存的模型檔案
  4. 載入模型後，顯示模型資訊（模型類型、目標變數、特徵名稱等）

- **單筆預測流程**:
  1. 根據模型的特徵名稱動態生成輸入表單
  2. 使用者輸入各特徵值
  3. 驗證輸入資料格式（數值型、類別型等）
  4. 執行預測
  5. 顯示預測結果（包含輸入資料和預測值）

- **批次預測流程**:
  1. 使用者上傳 CSV 檔案
  2. 驗證 CSV 檔案格式（欄位名稱、資料類型等）
  3. 檢查 CSV 欄位是否包含模型所需的所有特徵
  4. 執行批次預測
  5. 顯示預測結果表格
  6. 提供匯出功能

- **資料驗證**:
  - 檢查特徵數量是否一致
  - 檢查特徵名稱是否一致（順序可以不同）
  - 檢查資料類型是否匹配（數值型、類別型等）
  - 檢查類別型特徵的值是否在訓練時見過

- **預測結果格式**:
  - 單筆預測：顯示輸入特徵和預測值（單目標或多目標）
  - 批次預測：表格顯示，包含原始資料欄位和預測值欄位
  - 匯出格式：CSV，包含原始資料和預測值

## Risks / Trade-offs
- **Risk**: 輸入資料格式與模型特徵不一致可能導致預測失敗
  - **Mitigation**: 嚴格驗證輸入資料，提供清晰的錯誤訊息和修正建議

- **Risk**: 類別型特徵的值在預測時未見過可能導致錯誤
  - **Mitigation**: 檢查類別型特徵的值是否在訓練時見過，如果未見過則提示錯誤

- **Risk**: 批次預測的資料量過大可能導致記憶體問題
  - **Mitigation**: 限制批次預測的資料量上限（例如 10000 筆），或提供分批處理選項

- **Trade-off**: 功能完整性 vs 簡單性
  - **Choice**: 優先選擇簡單實作，提供核心預測功能，未來可擴展

## Open Questions
- 是否需要支援部分特徵預測（僅提供部分特徵，其他使用預設值）？
- 是否需要提供預測結果的統計資訊（平均值、標準差等）？
- 是否需要支援預測結果的可視化（散點圖、分布圖等）？

